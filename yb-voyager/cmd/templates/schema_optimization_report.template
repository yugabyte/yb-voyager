<!DOCTYPE html>
<html lang="en">
   <head>
      <meta charset="UTF-8">
      <title> Schema Optimization Summary</title>
      <style>
         body {
            font-family: Arial, sans-serif;
            margin: 0 auto;
            padding: 2rem;
            background-color: #f9f9f9;
            color: #333;
         }
         .wrapper {
            max-width: 60%;
            margin: 20px auto;
            padding: 20px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
         }
         h1, h2, h3 {
            text-align: left;
         }
         .section {
            margin-bottom: 2rem;
         }
         .file-link {
            color: #0077cc;
            text-decoration: none;
         }
         ul {
            padding-left: 1.5rem;
         }
         .scrollable-div {
            max-height: 300px;
            overflow-y: scroll;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            scrollbar-width: thin; /* Firefox */
            -ms-overflow-style: auto; /* IE 10+ */
         }
         .scrollable-div::-webkit-scrollbar {
            width: 8px;
            background: #f2f2f2;
         }
         .scrollable-div::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
         }
         .no-wrap-list li {
            white-space: nowrap;
            margin-right: 15px;
         list-style-type: disc;
         }
         /* Table Styles */
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 20px;
            table-layout: fixed;
            border-spacing: 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            vertical-align: middle;
            word-wrap: break-word;
            white-space: normal;
            box-sizing: border-box;
            margin: 0;
            word-break: break-word;
            overflow-wrap: break-word;
        }

         th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #ddd;
         }

        .formatted_table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        /* List Styles */
        ul {
            padding-left: 20px;
        }

        li {
            margin: 5px 0;
        }

        .scrollable-div {
            max-height: 300px;
            overflow-y: scroll;
            border: 1px solid #ccc; /* a visual separator from the body */
            padding: 10px;
            scrollbar-width: thin; /* Firefox */
            -ms-overflow-style: auto; /* IE 10+ */
        }

         .scrollable-div::-webkit-scrollbar {
            width: 8px;
            background: #f8f9fa;
         }
         
         .scrollable-div::-webkit-scrollbar-thumb {
            background: #ddd;
            border-radius: 4px;
         }

        .no-wrap-list li {
            white-space: nowrap;
            margin-right: 15px;
            list-style-type: disc;
        }

        /* Text and Alignment Styles */
        .centered-cell {
            text-align: center;
            vertical-align: middle;
        }

        #refer-p {
            font-size: 0.8em;
            color: inherit;
        }

        #refer-p a {
            color: inherit;
        }

        .list_item {
            margin-bottom: 15px;
        }

        /* Optimization Section Styles */
        .optimization-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .optimization-section.applied {
            background-color: #f0f9ff;
            border-left-color: #10b981;
            border: 1px solid #ffffff;
        }

        .optimization-section.not-applied {
            background-color: #fef3c7;
            border-left-color: #f59e0b;
            border: 1px solid #ffffff;
        }

        .optimization-section h3 {
            margin-top: 0;
            color: #1f2937;
        }

        .optimization-section.applied h3 {
            color: #065f46;
        }

        .optimization-section.not-applied h3 {
            color: #92400e;
        }

        /* Ensure table rows in optimization sections have white background */
        .optimization-section table tbody tr {
            background-color: white !important;
        }

        .optimization-section table tbody tr:nth-child(even) {
            background-color: white !important;
        }

        .optimization-section table tbody tr:nth-child(odd) {
            background-color: white !important;
        }

        pre {
            width: 100%;          /* Ensure content takes full width of container */
            margin: 0;            /* Remove default margins */
            padding: 8px;         /* Add consistent padding around code blocks */
            background: none;     /* Remove any background styling */
            border: none;         /* Remove any borders */
            white-space: pre-wrap;      /* CSS3: wrap as needed, preserve whitespace */
            word-break: break-word;     /* Break long words if needed */
            overflow-wrap: break-word;  /* Same as above, for newer browsers */
            box-sizing: border-box;     /* Include padding in element's total width */
            font-size: 1em; 
            white-space: pre-wrap; 
            word-break: break-word; 
            overflow-wrap: break-word; 
            margin: 0; 
            padding: 8px; 
            color: #000; 
            font-family: Arial, sans-serif;
        }

        /* Highlight Table Styles */
        .table-highlight {
            border-collapse: collapse;
            border-spacing: 0;
        }

        .table-highlight tr {
            height: auto;
            margin: 0;
            padding: 0;
        }

        .table-highlight td, .table-highlight th {
            height: 100%;
            min-height: 40px;
            vertical-align: middle;
            padding: 8px;
            box-sizing: border-box;
            border-bottom: none;
            margin: 0;
        }

        .summary-row {
            cursor: pointer;
            margin: 0;
        }

        .details-row {
            background-color: #fafafa;
            display: table-row;
            border-top: 1px solid #ddd;
            margin: 0;
        }
        
        .details-row > td {
            padding: 0;
            height: 0;
            overflow: hidden;
        }

        /* Details Content Animation */
        .details-content-wrapper {
            max-height: 0;
            overflow: hidden;
            visibility: hidden;
            opacity: 0;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out, visibility 0s linear 0.3s;
        }

        .details-row.show .details-content-wrapper {
            max-height: 1000px;
            visibility: visible;
            opacity: 1;
            transition: max-height 0.3s ease-in, opacity 0.3s ease-in, visibility 0s linear 0s;
        }

        .details-content {
            padding: 8px;
        }

        .table-highlight tbody {
            border-bottom: 2px solid #000;
            margin: 0;
            padding: 0;
        }

        .table-highlight tbody:last-child {
            border-bottom: none;
        }
        /* Container for the top summary + buttons */
      

        .spaced-words {
            word-spacing: 0.2em;
        }

                 /* Category and Arrow Styles */
         .category-cell-flex {
            display: flex;
            align-items: center;
            gap: 0.5em;
            height: 100%;
            padding-left: 0.5em;
            box-sizing: border-box;
            margin: 0;
         }
         
         /* Details Styling - matching footer box style */
         details {
            margin: 1.5rem 0;
         }
         
         summary {
            cursor: pointer;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #;
            font-weight: 600;
            color: #333;
            border: 1px solid #ddd;
         }
         
         summary:hover {
            background: #e9ecef;
         }
         
         details[open] summary {
            border-bottom-left-radius: 0;
            border-bottom-right-radius: 0;
            border-bottom: none;
         }
         
         details > div {
            padding: 1rem;
            border-radius: 0 0 8px 8px;
            border: 1px solid #ddd;
            border-top: none;
         }
      </style>
   </head>
   <body>
      <div class="wrapper">
         <h1 style="text-align:center">Schema Optimization Summary</h1>
         <div class="section">
            <p><strong>Voyager Version:</strong> {{.VoyagerVersion}}</p>
            <p><strong>Source DB Name:</strong> {{.SourceDatabaseName}}</p>
            <p><strong>Source Schema:</strong> {{.SourceDatabaseSchema}}</p>
            <p><strong>Source DB Version:</strong> {{.SourceDatabaseVersion}}</p>
            <p>Summary of schema optimizations and recommendations applied to improve performance and ensure compatibility with YugabyteDB’s distributed architecture.</p>
            {{ if .RedundantIndexChange }}
               <div class="optimization-section {{if .RedundantIndexChange.IsApplied}}applied{{else}}not-applied{{end}}">
                  <h3>
                     {{if .RedundantIndexChange.IsApplied}}✅ {{else}}⚠️ {{end}}
                     {{.RedundantIndexChange.Title}}
                  </h3>
                  <pre>{{.RedundantIndexChange.Description}}</pre>
                  {{if .RedundantIndexChange.IsApplied}}
                     <pre>Refer to the <a class="file-link" href="{{.RedundantIndexChange.ReferenceFile}}" target="_blank"> {{.RedundantIndexChange.ReferenceFileDisplayName}} </a></pre>
                  {{end}}

                  <details>
                     <summary>Details</summary>
                     <table>
                        <thead>
                           <tr>
                              <th class="centered-cell">Table</th>
                              <th class="centered-cell">Indexes</th>
                           </tr>
                        </thead>
                        <tbody>
                           {{range $table, $indexes := .RedundantIndexChange.TableToRemovedIndexesMap}}
                              <tr>
                                 <td>{{$table}}</td>
                                 <td class="scrollable-div">
                                    <ul>
                                       {{range $indexes}}
                                          <li>{{.}}</li>
                                       {{end}}
                                    </ul>
                                 </td>
                              </tr>
                           {{end}}
                        </tbody>
                     </table>
                  </details>
               </div>
            {{ end }}
         

            {{ if .TableShardingRecommendation }}
               <div class="optimization-section {{if .TableShardingRecommendation.IsApplied}}applied{{else}}not-applied{{end}}">
                  <h3>
                     {{if .TableShardingRecommendation.IsApplied}}✅ {{else}}⚠️ {{end}}
                     {{.TableShardingRecommendation.Title}}
                  </h3>
                  <pre>{{.TableShardingRecommendation.Description}}</pre>
                  {{if .TableShardingRecommendation.IsApplied}}
                     <pre>Refer to the <a class="file-link" href="{{.TableShardingRecommendation.ReferenceFile}}" target="_blank"> {{.TableShardingRecommendation.ReferenceFileDisplayName}} </a> for modified DDLs.</pre>
                     <details>
                        <summary>Details</summary>
                        <table>
                           <tr>
                                 <th class="centered-cell">Sharded Tables</th>
                                 <th class="centered-cell">Colocated Tables</th>
                           </tr>
                           <tr>
                                 <td>
                                    <div class="scrollable-div no-wrap-list">
                                       {{ range .TableShardingRecommendation.ShardedObjects}}
                                             <li>{{ . }}</li>
                                       {{ end }}
                                    </div>
                                 </td>
                                 <td>
                                    <div class="scrollable-div no-wrap-list">
                                       {{ range .TableShardingRecommendation.CollocatedObjects }}
                                             <li>{{ . }}</li>
                                       {{ end }}
                                    </div>
                                 </td>
                           </tr>
                        </table>
                     </details>
                  {{end}}
               </div>
            {{ end }}
   
            {{ if .MviewShardingRecommendation }}
               <h3>{{.MviewShardingRecommendation.Title}}</h3>
               <pre>{{.MviewShardingRecommendation.Description}}</pre>
               <pre>Refer to the <a class="file-link" href="{{.MviewShardingRecommendation.ReferenceFile}}" target="_blank"> {{.MviewShardingRecommendation.ReferenceFileDisplayName}} </a> for modified DDLs.</pre>
               <details>
                  <summary>Details</summary>
                  <table>
                     <tr>
                           <th class="centered-cell">Sharded Tables</th>
                           <th class="centered-cell">Colocated Tables</th>
                     </tr>
                     <tr>
                           <td>
                              <div class="scrollable-div no-wrap-list">
                                 {{ range .MviewShardingRecommendation.ShardedObjects}}
                                       <li>{{ . }}</li>
                                 {{ end }}
                              </div>
                           </td>
                           <td>
                              <div class="scrollable-div no-wrap-list">
                                 {{ range .MviewShardingRecommendation.CollocatedObjects }}
                                       <li>{{ . }}</li>
                                 {{ end }}
                              </div>
                           </td>
                     </tr>
                  </table>
               </details>
            {{ end }}
         </div>
         
         <!-- Footer Note -->
         <div class="footer-note">
            <hr style="margin: 2rem 0; border: none; border-top: 1px solid #ddd;">
            <div style="background-color: #f8f9fa; padding: 1rem; border-radius: 8px;">
               <h4 style="margin: 0 0 0.5rem 0; color: #333; font-size: 1rem;">Note: Skipping Schema Modifications</h4>
               <p style="margin: 0; color: #666; font-size: 0.9rem; line-height: 1.4;">
                  To prevent automatic schema modifications during export, use these flags:
               </p>
               <ul style="margin: 0.5rem 0 0 0; padding-left: 1.5rem; color: #666; font-size: 0.9rem;">
                  <li><strong>--skip-performance-optimizations true</strong> - Skip performance optimizations (e.g. redundant index removal)</li>
                  <li><strong>--skip-recommendations true</strong> - Skip sharding recommendations from assessment</li>
               </ul>
            </div>
         </div>
      </div>
   </body>
</html>