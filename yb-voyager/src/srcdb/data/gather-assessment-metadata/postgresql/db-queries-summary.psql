-- Use JSONB to avoid column compatibility issues across PostgreSQL versions
-- This approach works with any pg_stat_statements extension version
\o db-queries-summary.csv
COPY (
    SELECT
        :'source_node_name' AS source_node,
        to_jsonb(pgss.*) AS pgss_data
    FROM :schema_name.pg_stat_statements pgss
    WHERE dbid = (SELECT oid FROM pg_database WHERE datname = current_database())
) TO STDOUT WITH CSV HEADER;
\o
