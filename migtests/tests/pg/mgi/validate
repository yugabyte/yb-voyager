#!/usr/bin/env python3

import yb

def main():
	yb.run_checks(migration_completed_checks)


#=============================================================================

EXPECTED_TRIGGER_LIST = [
	"acc_accession_delete_trigger", 
	"all_allele_delete_trigger", 
	"all_allele_insert_trigger", 
	"all_allele_update_trigger", 
	"all_cellline_delete_trigger", 
	"all_cellline_update1_trigger", 
	"all_cellline_update2_trigger", 
	"prb_strain_delete_trigger", 
	"prb_strain_insert_trigger", 
	"voc_term_delete_trigger", 
	"mgi_organism_delete_trigger", 
	"mgi_organism_insert_trigger", 
	"mgi_relationship_delete_trigger", 
	"mrk_marker_delete_trigger", 
	"mrk_marker_insert_trigger", 
	"mrk_marker_update_trigger", 
	"voc_annot_insert_trigger", 
	"gxd_allelepair_insert_trigger", 
	"gxd_allelepair_insert_trigger", 
	"mgi_reference_assoc_delete_trigger", 
	"mgi_reference_assoc_insert_trigger", 
	"all_variant_delete_trigger", 
	"bib_refs_delete_trigger", 
	"bib_refs_insert_trigger", 
	"gxd_index_insert_before_trigger", 
	"gxd_index_insert_trigger", 
	"gxd_index_update_trigger", 
	"img_image_delete_trigger", 
	"img_image_insert_trigger", 
	"mld_expts_delete_trigger", 
	"mld_expts_insert_trigger", 
	"mrk_strainmarker_delete_trigger", 
	"prb_reference_delete_trigger", 
	"prb_reference_update_trigger", 
	"prb_source_delete_trigger", 
	"voc_evidence_delete_trigger", 
	"voc_evidence_insert_trigger", 
	"voc_evidence_insert_trigger", 
	"voc_evidence_update_trigger", 
	"gxd_assay_delete_trigger", 
	"gxd_assay_insert_trigger", 
	"gxd_antibody_delete_trigger", 
	"gxd_antibody_insert_trigger", 
	"gxd_antigen_delete_trigger", 
	"gxd_antigen_insert_trigger", 
	"gxd_gelrow_insert_trigger", 
	"gxd_gelrow_insert_trigger", 
	"gxd_genotype_delete_trigger", 
	"gxd_genotype_insert_trigger", 
	"gxd_htexperiment_delete_trigger", 
	"gxd_htrawsample_delete_trigger", 
	"gxd_htsample_ageminmax_trigger", 
	"gxd_htsample_ageminmax_trigger", 
	"prb_probe_delete_trigger", 
	"prb_probe_insert_trigger", 
	"mgi_setmember_emapa_insert_trigger", 
	"mgi_setmember_emapa_update_trigger", 
	"mld_expt_marker_update_trigger", 
	"mrk_cluster_delete_trigger", 
	"prb_marker_insert_trigger", 
	"prb_marker_update_trigger", 
	"seq_sequence_delete_trigger", 
	"voc_evidence_property_delete_trigger" 
]

EXPECTED_INDEX_COUNT = {
	'acc_accession':                    13,
	'acc_accessionmax':                  1,
	'acc_accessionreference':            6,
	'acc_actualdb':                      3,
	'acc_logicaldb':                     3,
	'acc_mgitype':                       3,
	'all_allele':                       15,
	'all_allele_cellline':               7,
	'all_allele_mutation':               5,
	'all_cellline':                      9,
	'all_cellline_derivation':          12,
	'all_cre_cache':                     7,
	'all_knockout_cache':                3,
	'all_label':                         5,
	'all_variant':                       8,
	'all_variant_sequence':              7,
	'bib_books':                         3,
	'bib_citation_cache':                8,
	'bib_notes':                         3,
	'bib_refs':                         11,
	'bib_workflow_data':                 7,
	'bib_workflow_relevance':            9,
	'bib_workflow_status':               9,
	'bib_workflow_tag':                  7,
	'crs_cross':                         7,
	'crs_matrix':                        3,
	'crs_progeny':                       1,
	'crs_references':                    2,
	'crs_typings':                       1,
	'dag_closure':                       8,
	'dag_dag':                           3,
	'dag_edge':                          5,
	'dag_label':                         2,
	'dag_node':                          4,
	'go_tracking':                       7,
	'gxd_allelegenotype':                5,
	'gxd_allelepair':                   13,
	'gxd_antibody':                      9,
	'gxd_antibodyalias':                 3,
	'gxd_antibodymarker':                3,
	'gxd_antibodyprep':                  4,
	'gxd_antigen':                       6,
	'gxd_assay':                        12,
	'gxd_assaynote':                     3,
	'gxd_assaytype':                     1,
	'gxd_expression':                   11,
	'gxd_gelband':                       4,
	'gxd_gellane':                       5,
	'gxd_gellanestructure':              4,
	'gxd_gelrow':                        3,
	'gxd_genotype':                      7,
	'gxd_htexperiment':                 13,
	'gxd_htexperimentvariable':          3,
	'gxd_htrawsample':                   6,
	'gxd_htsample':                     13,
	'gxd_htsample_rnaseq':               6,
	'gxd_htsample_rnaseqcombined':       5,
	'gxd_htsample_rnaseqset':           11,
	'gxd_htsample_rnaseqset_cache':      5,
	'gxd_htsample_rnaseqsetmember':      5,
	'gxd_index':                         9,
	'gxd_index_stages':                  8,
	'gxd_insituresult':                  4,
	'gxd_insituresultimage':             3,
	'gxd_isresultcelltype':              3,
	'gxd_isresultstructure':             4,
	'gxd_probeprep':                     5,
	'gxd_specimen':                      5,
	'gxd_theilerstage':                  1,
	'img_image':                         9,
	'img_imagepane':                     2,
	'img_imagepane_assoc':               6,
	'map_coord_collection':              4,
	'map_coord_feature':                 6,
	'map_coordinate':                    8,
	'mgi_dbinfo':                        1,
	'mgi_keyvalue':                      6,
	'mgi_note':                          6,
	'mgi_notetype':                      5,
	'mgi_organism':                      4,
	'mgi_organism_mgitype':              5,
	'mgi_property':                      8,
	'mgi_propertytype':                  6,
	'mgi_refassoctype':                  4,
	'mgi_reference_assoc':               7,
	'mgi_relationship':                 10,
	'mgi_relationship_category':         3,
	'mgi_relationship_property':         5,
	'mgi_set':                           5,
	'mgi_setmember':                     5,
	'mgi_setmember_emapa':               5,
	'mgi_synonym':                       8,
	'mgi_synonymtype':                   6,
	'mgi_translation':                   6,
	'mgi_translationtype':               6,
	'mgi_user':                          7,
	'mld_assay_types':                   2,
	'mld_concordance':                   2,
	'mld_contig':                        3,
	'mld_contigprobe':                   2,
	'mld_expt_marker':                   5,
	'mld_expt_notes':                    1,
	'mld_expts':                         6,
	'mld_fish':                          2,
	'mld_fish_region':                   1,
	'mld_hit':                           3,
	'mld_hybrid':                        1,
	'mld_insitu':                        2,
	'mld_isregion':                      1,
	'mld_matrix':                        2,
	'mld_mc2point':                      3,
	'mld_mcdatalist':                    1,
	'mld_notes':                         1,
	'mld_ri':                            2,
	'mld_ri2point':                      3,
	'mld_ridata':                        2,
	'mld_statistics':                    3,
	'mrk_biotypemapping':                8,
	'mrk_chromosome':                    3,
	'mrk_cluster':                       4,
	'mrk_clustermember':                 3,
	'mrk_current':                       2,
	'mrk_do_cache':                      6,
	'mrk_history':                      11,
	'mrk_label':                         7,
	'mrk_location_cache':                6,
	'mrk_marker':                       11,
	'mrk_mcv_cache':                     2,
	'mrk_mcv_count_cache':               1,
	'mrk_notes':                         2,
	'mrk_reference':                     2,
	'mrk_status':                        2,
	'mrk_strainmarker':                  6,
	'mrk_types':                         2,
	'prb_alias':                         5,
	'prb_allele':                        4,
	'prb_allele_strain':                 5,
	'prb_marker':                        7,
	'prb_notes':                         3,
	'prb_probe':                        11,
	'prb_ref_notes':                     2,
	'prb_reference':                     5,
	'prb_rflv':                          5,
	'prb_source':                       12,
	'prb_strain':                        8,
	'prb_strain_genotype':               6,
	'prb_strain_marker':                 7,
	'prb_tissue':                        2,
	'ri_riset':                          4,
	'ri_summary':                        3,
	'ri_summary_expt_ref':               3,
	'seq_allele_assoc':                  7,
	'seq_coord_cache':                   3,
	'seq_genemodel':                     4,
	'seq_genetrap':                      4,
	'seq_marker_cache':                 13,
	'seq_probe_cache':                   4,
	'seq_sequence':                      9,
	'seq_sequence_assoc':                6,
	'seq_sequence_raw':                  3,
	'seq_source_assoc':                  5,
	'voc_allele_cache':                  3,
	'voc_annot':                         5,
	'voc_annot_count_cache':             2,
	'voc_annotheader':                   7,
	'voc_annottype':                     7,
	'voc_evidence':                      8,
	'voc_evidence_property':             5,
	'voc_marker_cache':                  4,
	'voc_term':                          8,
	'voc_term_emapa':                    6,
	'voc_term_emaps':                    6,
	'voc_vocab':                         3,
	'voc_vocabdag':                      2,
	'wks_rosetta':                       2
}


def migration_completed_checks(tgt):

	table_list = tgt.get_table_names("mgd")
	print("table_list:", table_list)
	assert len(table_list) == 175

	fetched_triggers = tgt.fetch_all_triggers("mgd")
	print(f"fetched triggers list: {fetched_triggers}\n Expected triggers: {EXPECTED_TRIGGER_LIST}")
	assert sorted(fetched_triggers) == sorted(EXPECTED_TRIGGER_LIST), "Fetched triggers do not match expected triggers"

	fetched_procedures_functions = tgt.fetch_all_procedures("mgd")
	print(f"count of fecthed procedures/functions - {len(fetched_procedures_functions)}")
	assert len(fetched_procedures_functions) == 122

	num_sequences = tgt.count_sequences("mgd")
	print(f"actual number_sequences: {num_sequences}, expected num_sequences: 95")
	assert num_sequences == 95

	get_index_cnt = tgt.get_count_index_on_table("mgd")
	for table_name, index_count in EXPECTED_INDEX_COUNT.items():
		print(f"table_name: {table_name}, index_count: {get_index_cnt[table_name]}")
		assert index_count == get_index_cnt[table_name]

	view_list = tgt.get_objects_of_type("VIEW", "mgd")
	print("view_list:", view_list)
	assert len(view_list) == 126

if __name__ == "__main__":
	main()
